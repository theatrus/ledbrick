# Quick Action Scripts for LEDBrick

script:
  # Feeding mode with configurable duration
  feeding_mode_start:
    alias: "Start Feeding Mode"
    sequence:
      - service: input_boolean.turn_on
        target:
          entity_id: input_boolean.feeding_mode
  
  # Quick brightness adjustment
  set_quick_brightness:
    alias: "Set Quick Brightness"
    sequence:
      - service: number.set_value
        target:
          entity_id: number.ledbrickplus_pwm_scale
        data:
          value: "{{ states('input_number.ledbrick_quick_brightness') | int }}"
  
  # All lights off
  all_lights_off:
    alias: "All Lights Off"
    sequence:
      - service: switch.turn_off
        target:
          entity_id: switch.ledbrickplus_scheduler_enabled
      - service: light.turn_off
        target:
          entity_id: group.ledbrick_channels
  
  # Emergency shutdown
  emergency_shutdown:
    alias: "Emergency Shutdown"
    sequence:
      - service: switch.turn_off
        target:
          entity_id: switch.ledbrickplus_scheduler_enabled
      - service: number.set_value
        target:
          entity_id: number.ledbrickplus_pwm_scale
        data:
          value: 0
      - service: notify.mobile_app_phone
        data:
          title: "ðŸš¨ Emergency Shutdown"
          message: "LEDBrick has been shut down"
          data:
            importance: high
            color: red
  
  # Moonlight preview
  moonlight_preview:
    alias: "Preview Moonlight"
    sequence:
      # Temporarily disable scheduler
      - service: switch.turn_off
        target:
          entity_id: switch.ledbrickplus_scheduler_enabled
      
      # Turn off all channels
      - service: light.turn_off
        target:
          entity_id: group.ledbrick_channels
      
      # Wait for moon simulation to activate
      - delay:
          seconds: 2
      
      # Show for 30 seconds
      - delay:
          seconds: 30
      
      # Restore scheduler
      - service: switch.turn_on
        target:
          entity_id: switch.ledbrickplus_scheduler_enabled
  
  # Cycle through channels
  channel_test_cycle:
    alias: "Test All Channels"
    sequence:
      - repeat:
          count: 8
          sequence:
            - variables:
                channel_num: "{{ repeat.index }}"
            
            # Turn off all channels
            - service: light.turn_off
              target:
                entity_id: group.ledbrick_channels
            
            # Turn on current channel
            - service: light.turn_on
              target:
                entity_id: "light.ledbrickplus_channel_{{ channel_num }}"
              data:
                brightness_pct: 50
            
            # Announce which channel
            - service: notify.mobile_app_phone
              data:
                title: "Channel Test"
                message: "Testing channel {{ channel_num }}"
            
            # Wait 5 seconds
            - delay:
                seconds: 5
      
      # Restore normal operation
      - service: switch.turn_on
        target:
          entity_id: switch.ledbrickplus_scheduler_enabled
  
  # Sunrise preview (accelerated)
  sunrise_preview:
    alias: "Preview Sunrise"
    sequence:
      - service: notify.mobile_app_phone
        data:
          title: "ðŸŒ… Sunrise Preview"
          message: "Showing 2-hour sunrise in 2 minutes"
      
      # Create accelerated sunrise points
      - repeat:
          count: 12  # 12 points over 2 minutes (10 seconds each)
          sequence:
            - variables:
                progress: "{{ (repeat.index - 1) / 11 }}"
                pwm_blue: "{{ (5 + (85 * progress)) | int }}"
                pwm_white: "{{ (0 + (90 * progress)) | int }}"
                pwm_red: "{{ (0 + (30 * progress * progress)) | int }}"  # Red comes in later
            
            - service: light.turn_on
              target:
                entity_id: light.ledbrickplus_channel_1
              data:
                brightness_pct: "{{ pwm_blue }}"
            
            - service: light.turn_on
              target:
                entity_id: light.ledbrickplus_channel_4
              data:
                brightness_pct: "{{ pwm_white }}"
            
            - service: light.turn_on
              target:
                entity_id: light.ledbrickplus_channel_6
              data:
                brightness_pct: "{{ pwm_red }}"
            
            - delay:
                seconds: 10
      
      # Return to schedule
      - service: switch.turn_on
        target:
          entity_id: switch.ledbrickplus_scheduler_enabled
  
  # Storm effect
  create_storm_effect:
    alias: "Storm Effect"
    sequence:
      - service: input_boolean.turn_on
        target:
          entity_id: input_boolean.storm_mode_enabled
      
      - delay:
          minutes: 5
      
      - service: input_boolean.turn_off
        target:
          entity_id: input_boolean.storm_mode_enabled
  
  # Save current as custom preset
  save_current_as_preset:
    alias: "Save Current as Preset"
    fields:
      preset_name:
        description: "Name for the preset"
        example: "my_custom"
    sequence:
      - service: esphome.ledbrickplus_save_preset
        data:
          preset_name: "{{ preset_name }}"
      
      - service: notify.mobile_app_phone
        data:
          title: "ðŸ’¾ Preset Saved"
          message: "Current schedule saved as '{{ preset_name }}'"
  
  # Update moon intensity from sliders
  update_moon_intensity:
    alias: "Update Moon Intensity"
    sequence:
      - service: esphome.ledbrick_plus_set_moon_base_intensity_8ch
        data:
          intensity_ch1: "{{ states('input_number.moon_blue_intensity') | float }}"
          intensity_ch2: 0.0
          intensity_ch3: 0.0
          intensity_ch4: "{{ states('input_number.moon_white_intensity') | float }}"
          intensity_ch5: 0.0
          intensity_ch6: 0.0
          intensity_ch7: 0.0
          intensity_ch8: 0.0
      
      - service: notify.mobile_app_phone
        data:
          title: "ðŸŒ™ Moon Intensity Updated"
          message: "Blue: {{ states('input_number.moon_blue_intensity') }}%, White: {{ states('input_number.moon_white_intensity') }}%"

  # Reset to defaults
  reset_to_defaults:
    alias: "Reset to Defaults"
    sequence:
      - service: esphome.ledbrickplus_clear_schedule
      
      - service: esphome.ledbrickplus_load_preset
        data:
          preset_name: "dynamic_sunrise_sunset"
      
      - service: number.set_value
        target:
          entity_id: number.ledbrickplus_pwm_scale
        data:
          value: 100
      
      - service: switch.turn_on
        target:
          entity_id: switch.ledbrickplus_scheduler_enabled
      
      - service: switch.turn_on
        target:
          entity_id: switch.ledbrickplus_moon_simulation_enabled
      
      - service: notify.mobile_app_phone
        data:
          title: "ðŸ”„ Reset Complete"
          message: "LEDBrick reset to default settings"