# LEDBrick Monitoring Dashboard
# Real-time monitoring and analysis

views:
  - title: LEDBrick Monitor
    path: ledbrick-monitor
    icon: mdi:monitor-dashboard
    cards:
      # System Status
      - type: entities
        title: System Status
        show_header_toggle: false
        entities:
          - entity: sensor.ledbrickplus_uptime
            name: Uptime
            icon: mdi:timer-sand
            
          - entity: sensor.ledbrickplus_wifi_signal
            name: WiFi Signal
            icon: mdi:wifi
            
          - entity: sensor.ledbrickplus_temperature
            name: Internal Temperature
            icon: mdi:thermometer
            
          - entity: binary_sensor.ledbrickplus_status
            name: Connection Status
            icon: mdi:lan-connect
      
      # Power Monitoring
      - type: vertical-stack
        cards:
          - type: sensor
            entity: sensor.ledbrick_power_consumption
            name: Current Power
            graph: line
            detail: 2
            hours_to_show: 24
            
          - type: statistics-graph
            entities:
              - sensor.ledbrick_power_consumption
            stat_types:
              - mean
              - max
              - min
            period:
              days_to_show: 7
              fixed_period: true
            
          - type: entity
            entity: sensor.ledbrick_daily_energy
            name: Estimated Daily Usage
            icon: mdi:flash
      
      # Channel Analysis
      - type: custom:apexcharts-card
        header:
          show: true
          title: Channel Activity (24h)
        graph_span: 24h
        yaxis:
          - id: pwm
            min: 0
            max: 100
            apex_config:
              tickAmount: 5
          - id: current
            opposite: true
            min: 0
            max: 5
            apex_config:
              tickAmount: 5
        series:
          # PWM Values
          - entity: sensor.ledbrickplus_scheduler_pwm_channel_1
            name: Ch1 PWM
            color: blue
            yaxis_id: pwm
            stroke_width: 2
            
          - entity: sensor.ledbrickplus_scheduler_pwm_channel_4
            name: Ch4 PWM
            color: cyan
            yaxis_id: pwm
            stroke_width: 2
            
          # Current Values
          - entity: sensor.ledbrickplus_scheduler_current_channel_1
            name: Ch1 Current
            color: darkblue
            yaxis_id: current
            stroke_width: 1
            opacity: 0.5
            
          - entity: sensor.ledbrickplus_scheduler_current_channel_4
            name: Ch4 Current
            color: darkcyan
            yaxis_id: current
            stroke_width: 1
            opacity: 0.5
      
      # Temperature Monitoring
      - type: custom:mini-graph-card
        name: Temperature Trend
        icon: mdi:thermometer
        entities:
          - entity: sensor.ledbrickplus_temperature
            name: LED Driver
            color: orange
        hours_to_show: 48
        points_per_hour: 2
        show:
          labels: true
          average: true
          extrema: true
        color_thresholds:
          - value: 50
            color: green
          - value: 60
            color: yellow
          - value: 70
            color: red
      
      # Schedule Analysis
      - type: markdown
        content: |
          ## ðŸ“Š Schedule Analysis
          
          **Active Schedule Points:** {{ state_attr('sensor.ledbrickplus_schedule_info', 'point_count') | default('N/A') }}
          
          **Next Transition:** {{ state_attr('sensor.ledbrickplus_schedule_info', 'next_transition') | default('Unknown') }}
          
          **Peak Hours:** {{ state_attr('sensor.ledbrickplus_schedule_info', 'peak_hours') | default('Not calculated') }}
      
      # Moon Phase Calendar
      - type: custom:lunar-phase-card
        entity: sensor.ledbrickplus_moon_phase
        show_background: true
        compact_view: false
      
      # Alert History
      - type: history-graph
        title: Alert History
        hours_to_show: 168  # 1 week
        entities:
          - binary_sensor.ledbrick_temperature_alert
          - binary_sensor.ledbrick_power_alert
          - binary_sensor.ledbrick_schedule_alert
      
      # Statistics Cards
      - type: horizontal-stack
        cards:
          - type: statistic
            entity: sensor.ledbrick_power_consumption
            period:
              rolling_window:
                duration:
                  days: 30
            stat_type: mean
            name: 30-Day Avg Power
            
          - type: statistic
            entity: sensor.ledbrickplus_temperature
            period:
              rolling_window:
                duration:
                  days: 7
            stat_type: max
            name: 7-Day Max Temp
            
          - type: statistic
            entity: sensor.ledbrickplus_uptime
            period:
              rolling_window:
                duration:
                  days: 30
            stat_type: mean
            name: 30-Day Avg Uptime

# Binary sensors for alerts
binary_sensor:
  - platform: template
    sensors:
      ledbrick_temperature_alert:
        friendly_name: "LEDBrick Temperature Alert"
        device_class: heat
        value_template: >
          {{ states('sensor.ledbrickplus_temperature') | float(0) > 65 }}
        
      ledbrick_power_alert:
        friendly_name: "LEDBrick Power Alert"
        device_class: power
        value_template: >
          {{ states('sensor.ledbrick_power_consumption') | float(0) > 200 }}
        
      ledbrick_schedule_alert:
        friendly_name: "LEDBrick Schedule Alert"
        device_class: problem
        value_template: >
          {{ is_state('switch.ledbrickplus_scheduler_enabled', 'off') 
             and now().hour >= 8 and now().hour <= 20 }}