<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LEDBrick Control Panel</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>LEDBrick Control Panel</h1>
            <div class="status-bar">
                <span id="schedulerStatus" class="scheduler-status">Scheduler: --</span>
                <span id="currentTime" class="current-time">Time: --:--</span>
                <span id="schedulePoints" class="schedule-points">0 points</span>
            </div>
        </header>

        <!-- Quick Controls -->
        <section class="card">
            <h2>Quick Controls</h2>
            <div class="controls-grid">
                <button id="toggleScheduler" onclick="toggleScheduler()" class="control-button">
                    <span class="icon">‚è∏Ô∏è</span>
                    <span>Toggle Scheduler</span>
                </button>
                <div class="slider-control">
                    <label for="pwmScale">Master Brightness:</label>
                    <input type="range" id="pwmScale" min="0" max="100" value="100" 
                           oninput="updatePWMScale(this.value)">
                    <span id="pwmScaleValue">100%</span>
                </div>
            </div>
        </section>

        <!-- Schedule Visualization -->
        <section class="card">
            <h2>Schedule Visualization</h2>
            <div class="chart-container">
                <canvas id="scheduleChart"></canvas>
            </div>
            <div class="legend" id="channelLegend"></div>
        </section>

        <!-- Schedule Editor -->
        <section class="card">
            <h2>Schedule Editor</h2>
            <div class="schedule-controls">
                <button onclick="refreshSchedule()" class="button">üîÑ Refresh</button>
                <button onclick="clearSchedule()" class="button danger">üóëÔ∏è Clear All</button>
                <button onclick="showAddPointDialog()" class="button primary">‚ûï Add Point</button>
            </div>
            
            <div class="schedule-table-container">
                <table id="scheduleTable" class="schedule-table">
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>Type</th>
                            <th>Ch1<br><small>PWM/A</small></th>
                            <th>Ch2<br><small>PWM/A</small></th>
                            <th>Ch3<br><small>PWM/A</small></th>
                            <th>Ch4<br><small>PWM/A</small></th>
                            <th>Ch5<br><small>PWM/A</small></th>
                            <th>Ch6<br><small>PWM/A</small></th>
                            <th>Ch7<br><small>PWM/A</small></th>
                            <th>Ch8<br><small>PWM/A</small></th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="scheduleTableBody">
                        <!-- Schedule points will be populated here -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Presets -->
        <section class="card">
            <h2>Presets</h2>
            <div class="preset-grid">
                <button onclick="loadPreset('dynamic_sunrise_sunset')" class="preset-button">
                    <span class="icon">üåÖ</span>
                    <span>Sunrise/Sunset</span>
                </button>
                <button onclick="loadPreset('full_spectrum')" class="preset-button">
                    <span class="icon">üåà</span>
                    <span>Full Spectrum</span>
                </button>
                <button onclick="loadPreset('simple')" class="preset-button">
                    <span class="icon">üí°</span>
                    <span>Simple</span>
                </button>
                <button onclick="loadPreset('reef_natural')" class="preset-button">
                    <span class="icon">üê†</span>
                    <span>Reef Natural</span>
                </button>
                <button onclick="loadPreset('planted_co2')" class="preset-button">
                    <span class="icon">üåø</span>
                    <span>Planted CO2</span>
                </button>
                <button onclick="loadPreset('moonlight_only')" class="preset-button">
                    <span class="icon">üåô</span>
                    <span>Moonlight</span>
                </button>
            </div>
        </section>

        <!-- Import/Export -->
        <section class="card">
            <h2>Import/Export Schedule</h2>
            <div class="import-export-controls">
                <button onclick="exportSchedule()" class="button">üì§ Export JSON</button>
                <button onclick="importSchedule()" class="button">üì• Import JSON</button>
            </div>
            <textarea id="jsonData" placeholder="Paste JSON here or click Export to view current schedule..." 
                      class="json-textarea"></textarea>
            <div id="jsonStatus" class="status-message"></div>
        </section>

        <!-- Location Configuration -->
        <section class="card">
            <h2>Location Settings</h2>
            <div class="location-config">
                <div class="form-row">
                    <label for="latitude">Latitude:</label>
                    <input type="number" id="latitude" min="-90" max="90" step="0.0001" value="37.7749">
                    <span class="unit">¬∞</span>
                </div>
                <div class="form-row">
                    <label for="longitude">Longitude:</label>
                    <input type="number" id="longitude" min="-180" max="180" step="0.0001" value="-122.4194">
                    <span class="unit">¬∞</span>
                </div>
                <div class="location-presets">
                    <h4>City Presets:</h4>
                    <button onclick="setLocation(37.7749, -122.4194)" class="small-button">üåâ San Francisco</button>
                    <button onclick="setLocation(40.7128, -74.0060)" class="small-button">üóΩ New York</button>
                    <button onclick="setLocation(51.5074, -0.1278)" class="small-button">üè∞ London</button>
                    <button onclick="setLocation(1.3521, 103.8198)" class="small-button">üå¥ Singapore</button>
                    <h4>Reef Locations:</h4>
                    <button onclick="setLocation(-18.2871, 147.6992)" class="small-button">üê† Great Barrier Reef</button>
                    <button onclick="setLocation(18.3358, -64.8963)" class="small-button">üèùÔ∏è Caribbean (USVI)</button>
                    <button onclick="setLocation(27.9654, 34.3618)" class="small-button">üêü Red Sea (Sharm)</button>
                    <button onclick="setLocation(-8.3405, 115.0920)" class="small-button">üå∫ Bali</button>
                    <button onclick="setLocation(7.1301, 134.4445)" class="small-button">ü™∏ Palau</button>
                    <button onclick="setLocation(-17.4679, -149.9097)" class="small-button">üèñÔ∏è Tahiti</button>
                    <button onclick="setLocation(16.5165, -88.3669)" class="small-button">ü§ø Belize Reef</button>
                    <button onclick="setLocation(5.3167, 73.5000)" class="small-button">üèÑ Maldives</button>
                </div>
                <button onclick="saveLocation()" class="button primary">üìç Save Location</button>
            </div>
            
            <h3>Time Projection Settings</h3>
            <p class="help-text">Time projection allows you to shift astronomical events (sunrise/sunset) to different times. For example, project Singapore sunrise to 10 AM Pacific time.</p>
            <div class="form-row">
                <label>
                    <input type="checkbox" id="astronomicalProjection" onchange="updateTimeShiftUI()">
                    Enable Astronomical Projection
                </label>
            </div>
            <div id="timeShiftControls" style="display: none;">
                <div class="form-row">
                    <label for="timeShiftHours">Time Shift Hours:</label>
                    <input type="number" id="timeShiftHours" min="-12" max="12" step="1" value="0">
                    <span class="unit">hours</span>
                </div>
                <div class="form-row">
                    <label for="timeShiftMinutes">Time Shift Minutes:</label>
                    <input type="number" id="timeShiftMinutes" min="-59" max="59" step="1" value="0">
                    <span class="unit">minutes</span>
                </div>
                <button onclick="saveTimeShift()" class="button primary">üï∞Ô∏è Save Time Settings</button>
            </div>
        </section>

        <!-- Moon Simulation -->
        <section class="card">
            <h2>Moon Simulation</h2>
            <p class="help-text">Configure moonlight simulation for nighttime periods when all channels are dark.</p>
            
            <div class="form-row">
                <label>
                    <input type="checkbox" id="moonSimulationEnabled" onchange="updateMoonSimulationUI()">
                    Enable Moon Simulation
                </label>
            </div>
            
            <div id="moonSimulationControls" style="display: none;">
                <div class="form-row">
                    <label>
                        <input type="checkbox" id="moonPhaseScaling" checked>
                        Scale intensity by moon phase
                    </label>
                </div>
                
                <h4>Moon Base Intensity (per channel):</h4>
                <div class="moon-intensity-controls">
                    <div class="channel-input" data-channel="1">
                        <label>Ch1:</label>
                        <input type="range" id="moonCh1" min="0" max="20" step="0.1" value="2">
                        <input type="number" id="moonCh1Value" min="0" max="20" step="0.1" value="2">
                        <span class="unit">%</span>
                    </div>
                    <div class="channel-input" data-channel="2">
                        <label>Ch2:</label>
                        <input type="range" id="moonCh2" min="0" max="20" step="0.1" value="2">
                        <input type="number" id="moonCh2Value" min="0" max="20" step="0.1" value="2">
                        <span class="unit">%</span>
                    </div>
                    <div class="channel-input" data-channel="3">
                        <label>Ch3:</label>
                        <input type="range" id="moonCh3" min="0" max="20" step="0.1" value="2">
                        <input type="number" id="moonCh3Value" min="0" max="20" step="0.1" value="2">
                        <span class="unit">%</span>
                    </div>
                    <div class="channel-input" data-channel="4">
                        <label>Ch4:</label>
                        <input type="range" id="moonCh4" min="0" max="20" step="0.1" value="2">
                        <input type="number" id="moonCh4Value" min="0" max="20" step="0.1" value="2">
                        <span class="unit">%</span>
                    </div>
                    <div class="channel-input" data-channel="5">
                        <label>Ch5:</label>
                        <input type="range" id="moonCh5" min="0" max="20" step="0.1" value="2">
                        <input type="number" id="moonCh5Value" min="0" max="20" step="0.1" value="2">
                        <span class="unit">%</span>
                    </div>
                    <div class="channel-input" data-channel="6">
                        <label>Ch6:</label>
                        <input type="range" id="moonCh6" min="0" max="20" step="0.1" value="2">
                        <input type="number" id="moonCh6Value" min="0" max="20" step="0.1" value="2">
                        <span class="unit">%</span>
                    </div>
                    <div class="channel-input" data-channel="7">
                        <label>Ch7:</label>
                        <input type="range" id="moonCh7" min="0" max="20" step="0.1" value="2">
                        <input type="number" id="moonCh7Value" min="0" max="20" step="0.1" value="2">
                        <span class="unit">%</span>
                    </div>
                    <div class="channel-input" data-channel="8">
                        <label>Ch8:</label>
                        <input type="range" id="moonCh8" min="0" max="20" step="0.1" value="2">
                        <input type="number" id="moonCh8Value" min="0" max="20" step="0.1" value="2">
                        <span class="unit">%</span>
                    </div>
                </div>
                
                <div class="button-row">
                    <button onclick="setAllMoonChannels(0)" class="button secondary">üåë All Off</button>
                    <button onclick="setAllMoonChannels(2)" class="button secondary">üåò Dim</button>
                    <button onclick="setAllMoonChannels(5)" class="button secondary">üåï Bright</button>
                </div>
            </div>
            
            <button onclick="saveMoonSimulation()" class="button primary">üåô Save Moon Settings</button>
        </section>

        <!-- Channel Configuration -->
        <section class="card">
            <h2>Channel Configuration</h2>
            <div class="channel-config-table-container">
                <table id="channelConfigTable" class="channel-config-table">
                    <thead>
                        <tr>
                            <th>Channel</th>
                            <th>Color</th>
                            <th>Name</th>
                            <th>Max Current (A)</th>
                        </tr>
                    </thead>
                    <tbody id="channelConfigTableBody">
                        <!-- Channel configurations will be populated here -->
                    </tbody>
                </table>
            </div>
            <button onclick="saveChannelConfig()" class="button primary">üíæ Save Configuration</button>
        </section>
    </div>

    <!-- Add/Edit Point Dialog -->
    <div id="pointDialog" class="dialog-overlay" style="display: none;">
        <div class="dialog">
            <h3 id="dialogTitle">Add Schedule Point</h3>
            <div class="dialog-content">
                <div class="form-group">
                    <label>Point Type:</label>
                    <select id="pointType" onchange="updatePointTypeFields()">
                        <option value="fixed">Fixed Time</option>
                        <option value="sunrise">Sunrise</option>
                        <option value="sunset">Sunset</option>
                        <option value="astronomical">Astronomical</option>
                    </select>
                </div>
                
                <div id="fixedTimeFields" class="form-group">
                    <label>Time:</label>
                    <input type="time" id="pointTime" value="12:00">
                </div>
                
                <div id="astronomicalFields" class="form-group" style="display: none;">
                    <label>Base Event:</label>
                    <select id="astroEvent">
                        <option value="sunrise">Sunrise</option>
                        <option value="solar_noon">Solar Noon</option>
                        <option value="sunset">Sunset</option>
                        <option value="civil_dawn">Civil Dawn</option>
                        <option value="civil_dusk">Civil Dusk</option>
                        <option value="nautical_dawn">Nautical Dawn</option>
                        <option value="nautical_dusk">Nautical Dusk</option>
                    </select>
                    <label>Offset (minutes):</label>
                    <input type="number" id="astroOffset" value="0" min="-180" max="180">
                </div>
                
                <h4>Channel Values (0-100%)</h4>
                <div class="channel-grid">
                    <div class="channel-input" data-channel="1">
                        <label>Ch1:</label>
                        <input type="number" id="ch1Value" min="0" max="100" value="0">
                        <input type="range" min="0" max="100" value="0" 
                               oninput="document.getElementById('ch1Value').value=this.value">
                    </div>
                    <div class="channel-input" data-channel="2">
                        <label>Ch2:</label>
                        <input type="number" id="ch2Value" min="0" max="100" value="0">
                        <input type="range" min="0" max="100" value="0" 
                               oninput="document.getElementById('ch2Value').value=this.value">
                    </div>
                    <div class="channel-input" data-channel="3">
                        <label>Ch3:</label>
                        <input type="number" id="ch3Value" min="0" max="100" value="0">
                        <input type="range" min="0" max="100" value="0" 
                               oninput="document.getElementById('ch3Value').value=this.value">
                    </div>
                    <div class="channel-input" data-channel="4">
                        <label>Ch4:</label>
                        <input type="number" id="ch4Value" min="0" max="100" value="0">
                        <input type="range" min="0" max="100" value="0" 
                               oninput="document.getElementById('ch4Value').value=this.value">
                    </div>
                    <div class="channel-input" data-channel="5">
                        <label>Ch5:</label>
                        <input type="number" id="ch5Value" min="0" max="100" value="0">
                        <input type="range" min="0" max="100" value="0" 
                               oninput="document.getElementById('ch5Value').value=this.value">
                    </div>
                    <div class="channel-input" data-channel="6">
                        <label>Ch6:</label>
                        <input type="number" id="ch6Value" min="0" max="100" value="0">
                        <input type="range" min="0" max="100" value="0" 
                               oninput="document.getElementById('ch6Value').value=this.value">
                    </div>
                    <div class="channel-input" data-channel="7">
                        <label>Ch7:</label>
                        <input type="number" id="ch7Value" min="0" max="100" value="0">
                        <input type="range" min="0" max="100" value="0" 
                               oninput="document.getElementById('ch7Value').value=this.value">
                    </div>
                    <div class="channel-input" data-channel="8">
                        <label>Ch8:</label>
                        <input type="number" id="ch8Value" min="0" max="100" value="0">
                        <input type="range" min="0" max="100" value="0" 
                               oninput="document.getElementById('ch8Value').value=this.value">
                    </div>
                </div>
                
                <div class="channel-presets">
                    <button onclick="setAllChannels(0)" class="small-button">All Off</button>
                    <button onclick="setAllChannels(50)" class="small-button">All 50%</button>
                    <button onclick="setAllChannels(100)" class="small-button">All 100%</button>
                </div>
            </div>
            <div class="dialog-buttons">
                <button onclick="closePointDialog()" class="button">Cancel</button>
                <button onclick="saveSchedulePoint()" class="button primary">Save</button>
            </div>
        </div>
    </div>

    <script src="ledbrick-api.js"></script>
    <script src="ledbrick-ui.js"></script>
</body>
</html>