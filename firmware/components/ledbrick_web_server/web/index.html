<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LEDBrick Control Panel</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>LEDBrick Control Panel</h1>
            <div class="status-bar">
                <span id="connectionStatus" class="status-indicator disconnected">Disconnected</span>
                <span id="schedulerStatus" class="scheduler-status">Scheduler: --</span>
                <span id="currentTime" class="current-time">Time: --:--</span>
                <span id="schedulePoints" class="schedule-points">0 points</span>
            </div>
        </header>

        <!-- Connection Settings -->
        <section class="card" id="connectionSettings">
            <h2>Connection Settings</h2>
            <div class="form-row">
                <label for="deviceUrl">Device URL:</label>
                <input type="text" id="deviceUrl" placeholder="http://192.168.1.100" value="">
                <button onclick="testConnection()">Connect</button>
            </div>
            <div class="form-row">
                <label for="username">Username (optional):</label>
                <input type="text" id="username" placeholder="admin">
                <label for="password">Password:</label>
                <input type="password" id="password" placeholder="password">
            </div>
        </section>

        <!-- Quick Controls -->
        <section class="card">
            <h2>Quick Controls</h2>
            <div class="controls-grid">
                <button id="toggleScheduler" onclick="toggleScheduler()" class="control-button">
                    <span class="icon">‚è∏Ô∏è</span>
                    <span>Toggle Scheduler</span>
                </button>
                <div class="slider-control">
                    <label for="pwmScale">Master Brightness:</label>
                    <input type="range" id="pwmScale" min="0" max="100" value="100" 
                           oninput="updatePWMScale(this.value)">
                    <span id="pwmScaleValue">100%</span>
                </div>
            </div>
        </section>

        <!-- Channel Configuration -->
        <section class="card">
            <h2>Channel Configuration</h2>
            <div class="channel-config-grid" id="channelConfigGrid">
                <!-- Channel color pickers will be dynamically inserted here -->
            </div>
            <button onclick="saveChannelColors()" class="button primary">üíæ Save Colors</button>
        </section>

        <!-- Schedule Visualization -->
        <section class="card">
            <h2>Schedule Visualization</h2>
            <div class="chart-container">
                <canvas id="scheduleChart"></canvas>
            </div>
            <div class="legend" id="channelLegend"></div>
        </section>

        <!-- Schedule Editor -->
        <section class="card">
            <h2>Schedule Editor</h2>
            <div class="schedule-controls">
                <button onclick="refreshSchedule()" class="button">üîÑ Refresh</button>
                <button onclick="clearSchedule()" class="button danger">üóëÔ∏è Clear All</button>
                <button onclick="showAddPointDialog()" class="button primary">‚ûï Add Point</button>
            </div>
            
            <div class="schedule-table-container">
                <table id="scheduleTable" class="schedule-table">
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>Type</th>
                            <th>Ch1</th>
                            <th>Ch2</th>
                            <th>Ch3</th>
                            <th>Ch4</th>
                            <th>Ch5</th>
                            <th>Ch6</th>
                            <th>Ch7</th>
                            <th>Ch8</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="scheduleTableBody">
                        <!-- Schedule points will be populated here -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Presets -->
        <section class="card">
            <h2>Presets</h2>
            <div class="preset-grid">
                <button onclick="loadPreset('dynamic_sunrise_sunset')" class="preset-button">
                    <span class="icon">üåÖ</span>
                    <span>Sunrise/Sunset</span>
                </button>
                <button onclick="loadPreset('full_spectrum')" class="preset-button">
                    <span class="icon">üåà</span>
                    <span>Full Spectrum</span>
                </button>
                <button onclick="loadPreset('simple')" class="preset-button">
                    <span class="icon">üí°</span>
                    <span>Simple</span>
                </button>
                <button onclick="loadPreset('reef_natural')" class="preset-button">
                    <span class="icon">üê†</span>
                    <span>Reef Natural</span>
                </button>
                <button onclick="loadPreset('planted_co2')" class="preset-button">
                    <span class="icon">üåø</span>
                    <span>Planted CO2</span>
                </button>
                <button onclick="loadPreset('moonlight_only')" class="preset-button">
                    <span class="icon">üåô</span>
                    <span>Moonlight</span>
                </button>
            </div>
        </section>

        <!-- Import/Export -->
        <section class="card">
            <h2>Import/Export Schedule</h2>
            <div class="import-export-controls">
                <button onclick="exportSchedule()" class="button">üì§ Export JSON</button>
                <button onclick="importSchedule()" class="button">üì• Import JSON</button>
            </div>
            <textarea id="jsonData" placeholder="Paste JSON here or click Export to view current schedule..." 
                      class="json-textarea"></textarea>
            <div id="jsonStatus" class="status-message"></div>
        </section>
    </div>

    <!-- Add/Edit Point Dialog -->
    <div id="pointDialog" class="dialog-overlay" style="display: none;">
        <div class="dialog">
            <h3 id="dialogTitle">Add Schedule Point</h3>
            <div class="dialog-content">
                <div class="form-group">
                    <label>Point Type:</label>
                    <select id="pointType" onchange="updatePointTypeFields()">
                        <option value="fixed">Fixed Time</option>
                        <option value="sunrise">Sunrise</option>
                        <option value="sunset">Sunset</option>
                        <option value="astronomical">Astronomical</option>
                    </select>
                </div>
                
                <div id="fixedTimeFields" class="form-group">
                    <label>Time:</label>
                    <input type="time" id="pointTime" value="12:00">
                </div>
                
                <div id="astronomicalFields" class="form-group" style="display: none;">
                    <label>Base Event:</label>
                    <select id="astroEvent">
                        <option value="sunrise">Sunrise</option>
                        <option value="sunset">Sunset</option>
                        <option value="civil_dawn">Civil Dawn</option>
                        <option value="civil_dusk">Civil Dusk</option>
                        <option value="nautical_dawn">Nautical Dawn</option>
                        <option value="nautical_dusk">Nautical Dusk</option>
                    </select>
                    <label>Offset (minutes):</label>
                    <input type="number" id="astroOffset" value="0" min="-180" max="180">
                </div>
                
                <h4>Channel Values (0-100%)</h4>
                <div class="channel-grid">
                    <div class="channel-input" data-channel="1">
                        <label>Ch1:</label>
                        <input type="number" id="ch1Value" min="0" max="100" value="0">
                        <input type="range" min="0" max="100" value="0" 
                               oninput="document.getElementById('ch1Value').value=this.value">
                    </div>
                    <div class="channel-input" data-channel="2">
                        <label>Ch2:</label>
                        <input type="number" id="ch2Value" min="0" max="100" value="0">
                        <input type="range" min="0" max="100" value="0" 
                               oninput="document.getElementById('ch2Value').value=this.value">
                    </div>
                    <div class="channel-input" data-channel="3">
                        <label>Ch3:</label>
                        <input type="number" id="ch3Value" min="0" max="100" value="0">
                        <input type="range" min="0" max="100" value="0" 
                               oninput="document.getElementById('ch3Value').value=this.value">
                    </div>
                    <div class="channel-input" data-channel="4">
                        <label>Ch4:</label>
                        <input type="number" id="ch4Value" min="0" max="100" value="0">
                        <input type="range" min="0" max="100" value="0" 
                               oninput="document.getElementById('ch4Value').value=this.value">
                    </div>
                    <div class="channel-input" data-channel="5">
                        <label>Ch5:</label>
                        <input type="number" id="ch5Value" min="0" max="100" value="0">
                        <input type="range" min="0" max="100" value="0" 
                               oninput="document.getElementById('ch5Value').value=this.value">
                    </div>
                    <div class="channel-input" data-channel="6">
                        <label>Ch6:</label>
                        <input type="number" id="ch6Value" min="0" max="100" value="0">
                        <input type="range" min="0" max="100" value="0" 
                               oninput="document.getElementById('ch6Value').value=this.value">
                    </div>
                    <div class="channel-input" data-channel="7">
                        <label>Ch7:</label>
                        <input type="number" id="ch7Value" min="0" max="100" value="0">
                        <input type="range" min="0" max="100" value="0" 
                               oninput="document.getElementById('ch7Value').value=this.value">
                    </div>
                    <div class="channel-input" data-channel="8">
                        <label>Ch8:</label>
                        <input type="number" id="ch8Value" min="0" max="100" value="0">
                        <input type="range" min="0" max="100" value="0" 
                               oninput="document.getElementById('ch8Value').value=this.value">
                    </div>
                </div>
                
                <div class="channel-presets">
                    <button onclick="setAllChannels(0)" class="small-button">All Off</button>
                    <button onclick="setAllChannels(50)" class="small-button">All 50%</button>
                    <button onclick="setAllChannels(100)" class="small-button">All 100%</button>
                </div>
            </div>
            <div class="dialog-buttons">
                <button onclick="closePointDialog()" class="button">Cancel</button>
                <button onclick="saveSchedulePoint()" class="button primary">Save</button>
            </div>
        </div>
    </div>

    <script src="ledbrick-api.js"></script>
    <script src="ledbrick-ui.js"></script>
</body>
</html>